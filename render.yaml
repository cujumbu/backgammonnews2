services:
  # Main web service
  - type: web
    name: backgammon-news
    env: node
    plan: free
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
    autoDeploy: true
    # Add memory limit and scaling configuration
    scaling:
      minInstances: 1
      maxInstances: 1
    resources:
      limits:
        memory: 512M # Set memory limit to 512MB

  # Background worker for news fetching
  - type: cron
    name: backgammon-news-fetcher
    schedule: "0 */6 * * *" # Run every 6 hours
    env: node
    buildCommand: npm install
    startCommand: npm run fetch-news
    envVars:
      - key: NODE_ENV
        value: production
